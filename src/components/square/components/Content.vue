<template>
  <div
    class="soul-square-content"
    :class="{'soul-square-content-hide': isHide}"
    @touchstart="handleTouchStart"
    @touchmove="handleTouchMove"
    @touchend="handleTouchEnd"
  >
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
    <p>内容</p>
  </div>
</template>

<script>
export default {
  name: 'SoulSquareContent',
  data () {
    return {
      preClientY: 0, // 上次触碰的Y值
      currentClientY: 0, // 当前触碰的Y值
      moveClientY: 0, // Y轴移动的距离
      timer: null, // 节流器
      isHide: false // 判断content是否收起，小于0收起；大于0出现
    }
  },
  methods: {
    handleTouchStart (e) {
      this.preClientY = e.touches[0].clientY
    },
    handleTouchMove (e) {
      // 函数节流，提高性能
      if (this.timer) {
        clearTimeout(this.timer)
      }
      // 检测触碰滑动距离，用于隐藏header和修改content的margin-top值
      this.timer = setTimeout(() => {
        this.currentClientY = e.touches[0].clientY // 当前触碰的Y值
        this.moveClientY = this.currentClientY - this.preClientY // 更新Y轴移动距离
        this.preClientY = this.currentClientY // 下次执行的时候，preClientY变成当前的currentClientY
        this.$emit('touchChange', this.moveClientY) // 向父组件传递touchChange事件，携带moveClientY的值
        this.isHide = (this.moveClientY < 0)
      }, 16)
    },
    handleTouchEnd (e) {
      // 防止有未完成的timer继续执行
      if (this.timer) {
        clearTimeout(this.timer)
      }
    }
  }
}
</script>

<style>
.soul-square-content {
  position: relative;
  margin-top: 1rem;
  transition: 0.5s;
  z-index: var(--content);
}
.soul-square-content-hide {
  margin-top: 0;
}
</style>
